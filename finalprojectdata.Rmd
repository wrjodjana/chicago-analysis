---
title: "GGIS 224 Final Project Data Wrangling and Spatial Operations"
author: "Warren Jodjana"
date: "December 14th 2023"
output:   
  html_document:
    theme: cosmo
    toc: true
    toc_float: true
---



## Environment Setup
```{r, echo=TRUE, message = FALSE}
library(dplyr)
library(sf)
library(terra)
library(tmap)
library(readxl)
library(data.table)
```


# Clean & Wrangle Data

## Air Quality Index (AQI)

### Load AQI data using `read_excel`
```{r}
airquality <- read_excel("air-quality-index.xlsx")
glimpse(airquality)
```
### Load tract data using `st_read` 

```{r}
airquality_tracts <- st_read("tracts-aqi.geojson")
glimpse(airquality_tracts)
```

### Merge data using geoid
```{r}
airquality <- merge(airquality_tracts, airquality, by.x="geoid10", by.y="geoid", all.x=TRUE)
```

### Subset data
```{r}
airquality <- airquality %>%
  select(-c("statefp10", "commarea_n", "commarea", "notes", "countyfp10"))
```

### Inspect data using `data.table`
```{r}
data.table(airquality)
```

### Save cleaned data
```{r}
write.csv(airquality, "airquality.csv")
```

## Traffic & Vehicular Emissions


### Load traffic data using `fread`
```{r}
traffic <- fread("traffic-old.csv")
glimpse(traffic)
```

### Convert to spatial format
```{r}
traffic <- st_as_sf(traffic, coords = c("Longitude", "Latitude"), crs = 4326)
```

### Inspect data using `data.table`
```{r}
data.table(traffic)
```

### Save cleaned data
```{r}
write.csv(traffic, "traffic.csv")
```


## Electric Vehicles

### Load Alternative Fuel data using `fread`
```{r}
alternativefuel <- fread("alternativefuel.csv")
```

### Convert to spatial format
```{r}
alternativefuel <- st_as_sf(alternativefuel, coords = c("Longitude", "Latitude"), crs=4326)
data.table(alternativefuel)
```

### Subset data
```{r}
electric_vehicles <- alternativefuel %>%
  select(`ID`, `Fuel Type Code`, `Station Name`, `Street Address`, `Location`, `geometry`) %>%
  filter(`Fuel Type Code` == "ELEC") %>%
  mutate(`Street Address` = ifelse(`Station Name` == "Paul Simon Chicago JCC", "3348 S Kedzie Ave", `Street Address`)) %>%
  select(-c("Fuel Type Code"))
```

### Inspect data using `data.table`
```{r}
data.table(electric_vehicles)
```


### Save cleaned data
```{r}
write.csv(electric_vehicles, "electric-vehicles.csv")
```